name: Compiler le code, Executer le tests Unitaire, Executer les scans SAST, SCA, DAST.
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    name: Executer les tests unitaire et les tests SAST sur le code source.
    steps:
    - uses: actions/checkout@v3
    - name: Installer JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '19'
        distribution: 'temurin' 
        cache: 'maven'
    - name: ajouter le package SonarCloud au Cache
      uses: actions/cache@v3
      with:
        path: ~/.sonar/cache
        key: ${{runner.os}}-sonar
        restore-keys: ${{runner.os}}-sonar
    - name: ajouter les packages Maven au Cache
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{runner.os}}-m2-${{hashFiles('**/pom.xml')}}
        restore-key: ${{runner.os}}-m2
    - name: Compiler avec Maven et Verifier avec SonarCloud
      env:
        GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        SONAR_TOKEN: ${{secrets.SONAR_TOKEN}}
      run: mvn -B verify org.sonarsource.scanner.maven:sonar-maven-plugin:sonar -Dsonar.projectKey=java-project-key_transc
  # security:
  #   runs-on: ubuntu-latest
  #   needs: build
  #   name: Executer les Scan SCA sur le code source
  #   steps:
  #     - uses: actions/checkout@master
  #     - name: Identifier les vulnerablities avec Snyk
  #       uses: snyk/actions/maven@master
  #       continue-on-error: true
  #       env:
  #         SNYK_TOKEN: ${{secrets.SNYK_TOKEN}}
  # zap_scan:
  #   runs-on: ubuntu-latest
  #   name: Executer les scans DAST sur l'application Web.
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v2
  #       with:
  #         ref: master
  #     - name: Scan OWASP ZAP
  #       uses: zaproxy/action-baseline@v.0.6.1
  #       with:
  #         docker_name: 'owasp/zap2docker-stable'
  #         target: 'http://testphp.vulnweb.com'
  #         rules_file_name: '.zap/rules.tsv'
  #         cmd_options: '-a'
  #
